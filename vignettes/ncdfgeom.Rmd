---
title: "NetCDF Geometry and Timeseries Tools"
author: "David Blodgett"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup}
library(sf)
library(leaflet)


file.copy(system.file('extdata','example_huc_eta.nc', package = 'ncdfgeom'), 
					"hucPolygons.nc", 
					overwrite = TRUE) -> quiet

hucTimeseries <- ncdf4::nc_open("hucPolygons.nc")

et <- ncdf4::ncvar_get(hucTimeseries, hucTimeseries$var$et)
time <- as.POSIXct(hucTimeseries$dim$time$vals * 24*60*60, 
									 origin = strptime("1970-01-01", "%Y-%m-%d"))

plot(time, et[,1], main = "Monthly Evapotranspiration",pch=16)
lines(time, et[,1], pch=16)

hucPolygons <- read_sf(system.file('extdata','example_huc_eta.json', 
																					package = 'ncdfgeom'))

leaflet(hucPolygons) %>% addTiles() %>% addPolygons()

hucPolygons_nc <- ncdfgeom::ToNCDFSG(nc_file="hucPolygons.nc", 
																			 geomData = hucPolygons, 
																			 instance_names = hucPolygons$HUC12, 
																			 instance_dim_name = "station", 
																			 variables = hucTimeseries$var)

hucPolygons_sf <- ncdfgeom::FromNCDFSG("hucPolygons.nc")

hucPolygons_gpkg <- write_sf(hucPolygons_sf, "hucPolygons.gpkg")
unlink("hucPolygons.nc")
unlink("hucPolygons.gpkg")
```
